@model AgendaIR.Models.ViewModels.FuncionarioEditViewModel

@{
    ViewData["Title"] = "Editar Funcionário";
}

<!-- PAGE HEADER -->
<div class="page-header-rir">
    <div>
        <h2><i class="bi bi-pencil-square"></i> Editar Funcionário</h2>
        <p>Atualize os dados do funcionário conforme necessário</p>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-12 col-lg-10">
        <div class="card-rir">
            <div class="card-rir-body">
                <form asp-action="Edit" method="post">
                    <input type="hidden" asp-for="Id" />
                    <div asp-validation-summary="ModelOnly" class="alert-rir alert-rir-danger" role="alert"></div>

                    <h5 class="mb-3"><i class="bi bi-person-circle"></i> Dados Pessoais</h5>

                    <div class="mb-3">
                        <label asp-for="Nome" class="form-label fw-bold"></label>
                        <input asp-for="Nome" class="form-control" placeholder="Ex: João da Silva" />
                        <span asp-validation-for="Nome" class="text-danger"></span>
                    </div>

                    <div class="row">
                        <div class="col-12 col-md-6 mb-3">
                            <label asp-for="Email" class="form-label fw-bold"></label>
                            <input asp-for="Email" class="form-control" placeholder="exemplo@email.com" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <label asp-for="CPF" class="form-label fw-bold"></label>
                            <input asp-for="CPF" class="form-control" placeholder="000.000.000-00" maxlength="14" id="CPF" />
                            <span asp-validation-for="CPF" class="text-danger"></span>
                        </div>
                    </div>

                    <hr class="my-4" />

                    <h5 class="mb-3"><i class="bi bi-key-fill"></i> Dados de Acesso</h5>

                    <div class="mb-3">
                        <label asp-for="Username" class="form-label fw-bold"></label>
                        <input asp-for="Username" class="form-control" placeholder="Ex: joao.silva" />
                        <span asp-validation-for="Username" class="text-danger"></span>
                        <small class="form-text text-muted">Nome de usuário para fazer login no sistema</small>
                    </div>

                    <div class="alert-rir alert-rir-info mb-3">
                        <i class="bi bi-info-circle" style="font-size: 1.5rem;"></i>
                        <div>
                            <strong>Atenção:</strong> Para manter a senha atual, deixe os campos abaixo em branco. 
                            Preencha apenas se desejar alterar a senha.
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-md-6 mb-3">
                            <label asp-for="NovaSenha" class="form-label fw-bold"></label>
                            <div class="input-group">
                                <input asp-for="NovaSenha" class="form-control" id="novaSenha" type="password" placeholder="Mínimo 6 caracteres" />
                                <button class="btn btn-outline-secondary" type="button" id="toggleNovaSenha">
                                    <i class="bi bi-eye-fill" id="iconNovaSenha"></i>
                                </button>
                            </div>
                            <span asp-validation-for="NovaSenha" class="text-danger"></span>
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <label asp-for="ConfirmarNovaSenha" class="form-label fw-bold"></label>
                            <div class="input-group">
                                <input asp-for="ConfirmarNovaSenha" class="form-control" id="confirmarNovaSenha" type="password" />
                                <button class="btn btn-outline-secondary" type="button" id="toggleConfirmarNovaSenha">
                                    <i class="bi bi-eye-fill" id="iconConfirmarNovaSenha"></i>
                                </button>
                            </div>
                            <span asp-validation-for="ConfirmarNovaSenha" class="text-danger"></span>
                        </div>
                    </div>

                    <hr class="my-4" />

                    <h5 class="mb-3"><i class="bi bi-calendar-check"></i> Integração Google Calendar (Opcional)</h5>

                    <div class="mb-3">
                        <label asp-for="GoogleCalendarEmail" class="form-label fw-bold"></label>
                        <input asp-for="GoogleCalendarEmail" class="form-control" placeholder="exemplo@gmail.com" />
                        <span asp-validation-for="GoogleCalendarEmail" class="text-danger"></span>
                        <small class="form-text text-muted">E-mail da conta do Google Calendar para integração</small>
                    </div>

                    <hr class="my-4" />

                    <h5 class="mb-3"><i class="bi bi-shield-check"></i> Permissões e Status</h5>

                    <div class="row">
                        <div class="col-12 col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="IsAdmin" class="form-check-input" type="checkbox" id="isAdmin" />
                                <label asp-for="IsAdmin" class="form-check-label fw-bold" for="isAdmin">
                                    Este funcionário é administrador?
                                </label>
                            </div>
                            <small class="form-text text-muted">Administradores têm acesso total ao sistema</small>
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="Ativo" class="form-check-input" type="checkbox" id="ativo" />
                                <label asp-for="Ativo" class="form-check-label fw-bold" for="ativo">
                                    Funcionário ativo?
                                </label>
                            </div>
                            <small class="form-text text-muted">Funcionários inativos não podem fazer login</small>
                        </div>
                    </div>

                    <hr class="my-4" />

                    <div class="d-flex flex-column flex-md-row justify-content-between gap-2">
                        <a asp-action="Index" class="btn-rir-secondary">
                            <i class="bi bi-arrow-left"></i> Cancelar
                        </a>
                        <button type="submit" class="btn-rir-primary">
                            <i class="bi bi-save-fill"></i> Salvar Alterações
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        document.getElementById('toggleNovaSenha').addEventListener('click', function() {
            const novaSenhaInput = document.getElementById('novaSenha');
            const icon = document.getElementById('iconNovaSenha');
            
            if (novaSenhaInput.type === 'password') {
                novaSenhaInput.type = 'text';
                icon.classList.remove('bi-eye-fill');
                icon.classList.add('bi-eye-slash-fill');
            } else {
                novaSenhaInput.type = 'password';
                icon.classList.remove('bi-eye-slash-fill');
                icon.classList.add('bi-eye-fill');
            }
        });

        document.getElementById('toggleConfirmarNovaSenha').addEventListener('click', function() {
            const confirmarNovaSenhaInput = document.getElementById('confirmarNovaSenha');
            const icon = document.getElementById('iconConfirmarNovaSenha');
            
            if (confirmarNovaSenhaInput.type === 'password') {
                confirmarNovaSenhaInput.type = 'text';
                icon.classList.remove('bi-eye-fill');
                icon.classList.add('bi-eye-slash-fill');
            } else {
                confirmarNovaSenhaInput.type = 'password';
                icon.classList.remove('bi-eye-slash-fill');
                icon.classList.add('bi-eye-fill');
            }
        });

        document.getElementById('CPF').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            
            if (value.length > 9) {
                value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            } else if (value.length > 6) {
                value = value.replace(/(\d{3})(\d{3})(\d{3})/, '$1.$2.$3');
            } else if (value.length > 3) {
                value = value.replace(/(\d{3})(\d{3})/, '$1.$2');
            }
            
            e.target.value = value;
        });
    </script>
}
